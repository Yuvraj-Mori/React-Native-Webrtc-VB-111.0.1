{"version":3,"names":["_eventTargetShim","require","_reactNative","_MediaStreamTrack","_interopRequireDefault","_RTCUtil","obj","__esModule","default","_defineProperty","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","WebRTCModule","NativeModules","MEDIA_STREAM_EVENTS","MediaStream","defineCustomEventTarget","constructor","id","uniqueID","_reactTag","mediaStreamCreate","track","getTracks","addTrack","Array","isArray","streamId","streamReactTag","tracks","trackInfo","_tracks","push","MediaStreamTrack","index","indexOf","mediaStreamAddTrack","remote","_peerConnectionId","removeTrack","splice","mediaStreamRemoveTrack","slice","getTrackById","trackId","find","getAudioTracks","filter","kind","getVideoTracks","clone","Error","toURL","release","releaseTracks","arguments","length","mediaStreamRelease","exports"],"sources":["MediaStream.ts"],"sourcesContent":["\nimport { defineCustomEventTarget } from 'event-target-shim';\nimport { NativeModules } from 'react-native';\n\nimport MediaStreamTrack from './MediaStreamTrack';\nimport { uniqueID } from './RTCUtil';\n\nconst { WebRTCModule } = NativeModules;\n\nconst MEDIA_STREAM_EVENTS = [ 'active', 'inactive', 'addtrack', 'removetrack' ];\n\nexport default class MediaStream extends defineCustomEventTarget(...MEDIA_STREAM_EVENTS) {\n    id: string;\n    active = true;\n\n    _tracks: MediaStreamTrack[] = [];\n\n    /**\n     * The identifier of this MediaStream unique within the associated\n     * WebRTCModule instance. As the id of a remote MediaStream instance is unique\n     * only within the associated RTCPeerConnection, it is not sufficiently unique\n     * to identify this MediaStream across multiple RTCPeerConnections and to\n     * unambiguously differentiate it from a local MediaStream instance not added\n     * to an RTCPeerConnection.\n     */\n    _reactTag: string;\n\n    /**\n     * A MediaStream can be constructed in several ways, depending on the parameters\n     * that are passed here.\n     *\n     * - undefined: just a new stream, with no tracks.\n     * - MediaStream instance: a new stream, with a copy of the tracks of the passed stream.\n     * - Array of MediaStreamTrack: a new stream with a copy of the tracks in the array.\n     * - object: a new stream instance, represented by the passed info object, this is always\n     *   done internally, when the stream is first created in native and the JS wrapper is\n     *   built afterwards.\n     */\n    constructor(arg) {\n        super();\n\n        // Assigm a UUID to start with. It may get overridden for remote streams.\n        this.id = uniqueID();\n        // Local MediaStreams are created by WebRTCModule to have their id and\n        // reactTag equal because WebRTCModule follows the respective standard's\n        // recommendation for id generation i.e. uses UUID which is unique enough\n        // for the purposes of reactTag.\n        this._reactTag = this.id;\n\n        if (typeof arg === 'undefined') {\n            WebRTCModule.mediaStreamCreate(this.id);\n        } else if (arg instanceof MediaStream) {\n            WebRTCModule.mediaStreamCreate(this.id);\n\n            for (const track of arg.getTracks()) {\n                this.addTrack(track);\n            }\n        } else if (Array.isArray(arg)) {\n            WebRTCModule.mediaStreamCreate(this.id);\n\n            for (const track of arg) {\n                this.addTrack(track);\n            }\n        } else if (typeof arg === 'object' && arg.streamId && arg.streamReactTag && arg.tracks) {\n            this.id = arg.streamId;\n            this._reactTag = arg.streamReactTag;\n\n            for (const trackInfo of arg.tracks) {\n                // We are not using addTrack here because the track is already part of the\n                // stream, so there is no need to add it on the native side.\n                this._tracks.push(new MediaStreamTrack(trackInfo));\n            }\n        } else {\n            throw new TypeError(`invalid type: ${typeof arg}`);\n        }\n    }\n\n    addTrack(track: MediaStreamTrack): void {\n        const index = this._tracks.indexOf(track);\n\n        if (index !== -1) {\n            return;\n        }\n\n        this._tracks.push(track);\n        WebRTCModule.mediaStreamAddTrack(this._reactTag, track.remote ? track._peerConnectionId : -1, track.id);\n    }\n\n    removeTrack(track: MediaStreamTrack): void {\n        const index = this._tracks.indexOf(track);\n\n        if (index === -1) {\n            return;\n        }\n\n        this._tracks.splice(index, 1);\n        WebRTCModule.mediaStreamRemoveTrack(this._reactTag, track.remote ? track._peerConnectionId : -1, track.id);\n    }\n\n    getTracks(): MediaStreamTrack[] {\n        return this._tracks.slice();\n    }\n\n    getTrackById(trackId): MediaStreamTrack | undefined {\n        return this._tracks.find(track => track.id === trackId);\n    }\n\n    getAudioTracks(): MediaStreamTrack[] {\n        return this._tracks.filter(track => track.kind === 'audio');\n    }\n\n    getVideoTracks(): MediaStreamTrack[] {\n        return this._tracks.filter(track => track.kind === 'video');\n    }\n\n    clone(): never {\n        throw new Error('Not implemented.');\n    }\n\n    toURL(): string {\n        return this._reactTag;\n    }\n\n    release(releaseTracks = true): void {\n        const tracks = [ ...this._tracks ];\n\n        for (const track of tracks) {\n            this.removeTrack(track);\n\n            if (releaseTracks) {\n                track.release();\n            }\n        }\n\n        WebRTCModule.mediaStreamRelease(this._reactTag);\n    }\n}\n"],"mappings":"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"}