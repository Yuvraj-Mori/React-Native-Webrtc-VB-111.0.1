{"version":3,"names":["_reactNative","require","_defineProperty","obj","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","WebRTCModule","NativeModules","Permissions","constructor","DENIED","GRANTED","PROMPT","Promise","resolve","_requestPermissionAndroid","perm","PermissionsAndroid","request","then","granted","RESULTS","_validatePermissionDescriptior","permissionDesc","name","VALID_PERMISSIONS","indexOf","query","e","reject","Platform","OS","PERMISSIONS","CAMERA","RECORD_AUDIO","check","RESULT","checkPermission","requestPermission","_lastReq","_default","exports","default"],"sources":["Permissions.ts"],"sourcesContent":["\nimport { NativeModules, Permission, PermissionsAndroid, Platform } from 'react-native';\n\nconst { WebRTCModule } = NativeModules;\n\n/**\n * Type declaration for a permissions descriptor.\n */\ntype PermissionDescriptor = {\n    name: string;\n};\n\n/**\n * Class implementing a subset of W3C's Permissions API as defined by:\n * https://www.w3.org/TR/permissions/\n */\nclass Permissions {\n    /**\n     * Possible result values for {@link query}, in accordance with:\n     * https://www.w3.org/TR/permissions/#status-of-a-permission\n     */\n    RESULT = {\n        DENIED: 'denied',\n        GRANTED: 'granted',\n        PROMPT: 'prompt'\n    };\n\n    /**\n     * This implementation only supports requesting these permissions, a subset\n     * of: https://www.w3.org/TR/permissions/#permission-registry\n     */\n    VALID_PERMISSIONS = [ 'camera', 'microphone' ];\n\n    _lastReq: Promise<unknown> = Promise.resolve();\n\n    /**\n     * Helper for requesting Android permissions. On Android only one permission\n     * can be requested at a time (unless the multi-permission API is used,\n     * but we are not using that for symmetry with the W3C API for querying)\n     * so we'll queue them up.\n     *\n     * @param perm - The requested permission from\n     * {@link PermissionsAndroid.PERMISSIONS}\n     * https://facebook.github.io/react-native/docs/permissionsandroid#permissions-that-require-prompting-the-user\n     */\n    _requestPermissionAndroid(perm: Permission) {\n        return new Promise(resolve => {\n            PermissionsAndroid.request(perm).then(\n                granted => resolve(granted === PermissionsAndroid.RESULTS.GRANTED),\n                () => resolve(false)\n            );\n        });\n    }\n\n    /**\n     * Validates the given permission descriptor.\n     */\n    _validatePermissionDescriptior(permissionDesc) {\n        if (typeof permissionDesc !== 'object') {\n            throw new TypeError('Argument 1 of Permissions.query is not an object.');\n        }\n\n        if (typeof permissionDesc.name === 'undefined') {\n            throw new TypeError('Missing required \\'name\\' member of PermissionDescriptor.');\n        }\n\n        if (this.VALID_PERMISSIONS.indexOf(permissionDesc.name) === -1) {\n            throw new TypeError(\n                '\\'name\\' member of PermissionDescriptor is not a valid value for enumeration PermissionName.'\n            );\n        }\n    }\n\n    /**\n     * Method for querying the status of a permission, according to:\n     * https://www.w3.org/TR/permissions/#permissions-interface\n     */\n    query(permissionDesc: PermissionDescriptor) {\n        try {\n            this._validatePermissionDescriptior(permissionDesc);\n        } catch (e) {\n            return Promise.reject(e);\n        }\n\n        if (Platform.OS === 'android') {\n            const perm =\n                permissionDesc.name === 'camera'\n                    ? PermissionsAndroid.PERMISSIONS.CAMERA\n                    : PermissionsAndroid.PERMISSIONS.RECORD_AUDIO;\n\n            return new Promise(resolve => {\n                PermissionsAndroid.check(perm).then(\n                    granted => resolve(granted ? this.RESULT.GRANTED : this.RESULT.PROMPT),\n                    () => resolve(this.RESULT.PROMPT)\n                );\n            });\n        } else if (Platform.OS === 'ios' || Platform.OS === 'macos') {\n            return WebRTCModule.checkPermission(permissionDesc.name);\n        } else {\n            return Promise.reject(new TypeError('Unsupported platform.'));\n        }\n    }\n\n    /**\n     * Custom method NOT defined by W3C's permissions API, which allows the\n     * caller to request a permission.\n     */\n    request(permissionDesc: PermissionDescriptor) {\n        try {\n            this._validatePermissionDescriptior(permissionDesc);\n        } catch (e) {\n            return Promise.reject(e);\n        }\n\n        if (Platform.OS === 'android') {\n            const perm =\n                permissionDesc.name === 'camera'\n                    ? PermissionsAndroid.PERMISSIONS.CAMERA\n                    : PermissionsAndroid.PERMISSIONS.RECORD_AUDIO;\n            const requestPermission = () => this._requestPermissionAndroid(perm);\n\n            this._lastReq = this._lastReq.then(requestPermission, requestPermission);\n\n            return this._lastReq;\n        } else if (Platform.OS === 'ios' || Platform.OS === 'macos') {\n            return WebRTCModule.requestPermission(permissionDesc.name);\n        } else {\n            return Promise.reject(new TypeError('Unsupported platform.'));\n        }\n    }\n}\n\nexport default new Permissions();\n"],"mappings":"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"}