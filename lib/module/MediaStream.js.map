{"version":3,"names":["defineCustomEventTarget","NativeModules","MediaStreamTrack","uniqueID","WebRTCModule","MEDIA_STREAM_EVENTS","MediaStream","constructor","arg","_defineProperty","id","_reactTag","mediaStreamCreate","track","getTracks","addTrack","Array","isArray","streamId","streamReactTag","tracks","trackInfo","_tracks","push","TypeError","index","indexOf","mediaStreamAddTrack","remote","_peerConnectionId","removeTrack","splice","mediaStreamRemoveTrack","slice","getTrackById","trackId","find","getAudioTracks","filter","kind","getVideoTracks","clone","Error","toURL","release","releaseTracks","arguments","length","undefined","mediaStreamRelease"],"sources":["MediaStream.ts"],"sourcesContent":["\nimport { defineCustomEventTarget } from 'event-target-shim';\nimport { NativeModules } from 'react-native';\n\nimport MediaStreamTrack from './MediaStreamTrack';\nimport { uniqueID } from './RTCUtil';\n\nconst { WebRTCModule } = NativeModules;\n\nconst MEDIA_STREAM_EVENTS = [ 'active', 'inactive', 'addtrack', 'removetrack' ];\n\nexport default class MediaStream extends defineCustomEventTarget(...MEDIA_STREAM_EVENTS) {\n    id: string;\n    active = true;\n\n    _tracks: MediaStreamTrack[] = [];\n\n    /**\n     * The identifier of this MediaStream unique within the associated\n     * WebRTCModule instance. As the id of a remote MediaStream instance is unique\n     * only within the associated RTCPeerConnection, it is not sufficiently unique\n     * to identify this MediaStream across multiple RTCPeerConnections and to\n     * unambiguously differentiate it from a local MediaStream instance not added\n     * to an RTCPeerConnection.\n     */\n    _reactTag: string;\n\n    /**\n     * A MediaStream can be constructed in several ways, depending on the parameters\n     * that are passed here.\n     *\n     * - undefined: just a new stream, with no tracks.\n     * - MediaStream instance: a new stream, with a copy of the tracks of the passed stream.\n     * - Array of MediaStreamTrack: a new stream with a copy of the tracks in the array.\n     * - object: a new stream instance, represented by the passed info object, this is always\n     *   done internally, when the stream is first created in native and the JS wrapper is\n     *   built afterwards.\n     */\n    constructor(arg) {\n        super();\n\n        // Assigm a UUID to start with. It may get overridden for remote streams.\n        this.id = uniqueID();\n        // Local MediaStreams are created by WebRTCModule to have their id and\n        // reactTag equal because WebRTCModule follows the respective standard's\n        // recommendation for id generation i.e. uses UUID which is unique enough\n        // for the purposes of reactTag.\n        this._reactTag = this.id;\n\n        if (typeof arg === 'undefined') {\n            WebRTCModule.mediaStreamCreate(this.id);\n        } else if (arg instanceof MediaStream) {\n            WebRTCModule.mediaStreamCreate(this.id);\n\n            for (const track of arg.getTracks()) {\n                this.addTrack(track);\n            }\n        } else if (Array.isArray(arg)) {\n            WebRTCModule.mediaStreamCreate(this.id);\n\n            for (const track of arg) {\n                this.addTrack(track);\n            }\n        } else if (typeof arg === 'object' && arg.streamId && arg.streamReactTag && arg.tracks) {\n            this.id = arg.streamId;\n            this._reactTag = arg.streamReactTag;\n\n            for (const trackInfo of arg.tracks) {\n                // We are not using addTrack here because the track is already part of the\n                // stream, so there is no need to add it on the native side.\n                this._tracks.push(new MediaStreamTrack(trackInfo));\n            }\n        } else {\n            throw new TypeError(`invalid type: ${typeof arg}`);\n        }\n    }\n\n    addTrack(track: MediaStreamTrack): void {\n        const index = this._tracks.indexOf(track);\n\n        if (index !== -1) {\n            return;\n        }\n\n        this._tracks.push(track);\n        WebRTCModule.mediaStreamAddTrack(this._reactTag, track.remote ? track._peerConnectionId : -1, track.id);\n    }\n\n    removeTrack(track: MediaStreamTrack): void {\n        const index = this._tracks.indexOf(track);\n\n        if (index === -1) {\n            return;\n        }\n\n        this._tracks.splice(index, 1);\n        WebRTCModule.mediaStreamRemoveTrack(this._reactTag, track.remote ? track._peerConnectionId : -1, track.id);\n    }\n\n    getTracks(): MediaStreamTrack[] {\n        return this._tracks.slice();\n    }\n\n    getTrackById(trackId): MediaStreamTrack | undefined {\n        return this._tracks.find(track => track.id === trackId);\n    }\n\n    getAudioTracks(): MediaStreamTrack[] {\n        return this._tracks.filter(track => track.kind === 'audio');\n    }\n\n    getVideoTracks(): MediaStreamTrack[] {\n        return this._tracks.filter(track => track.kind === 'video');\n    }\n\n    clone(): never {\n        throw new Error('Not implemented.');\n    }\n\n    toURL(): string {\n        return this._reactTag;\n    }\n\n    release(releaseTracks = true): void {\n        const tracks = [ ...this._tracks ];\n\n        for (const track of tracks) {\n            this.removeTrack(track);\n\n            if (releaseTracks) {\n                track.release();\n            }\n        }\n\n        WebRTCModule.mediaStreamRelease(this._reactTag);\n    }\n}\n"],"mappings":"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"}